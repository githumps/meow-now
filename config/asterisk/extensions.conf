; Asterisk Dialplan for Meow-Now
; This routes incoming calls to the AGI server

[general]
static=yes
writeprotect=no

[globals]
; AGI server location (container name in Docker, or IP address)
AGI_HOST=meow-now
AGI_PORT=4573

[from-trunk]
; Context for incoming calls from NumberBarn SIP trunk
exten => _X.,1,NoOp(Incoming call from ${CALLERID(num)} to ${EXTEN})
 same => n,Answer()
 same => n,Wait(1)
 same => n,AGI(agi://${AGI_HOST}:${AGI_PORT})
 same => n,Hangup()

[from-numberbarn]
; Specific context for NumberBarn trunk
; Replace with your DID number
exten => 15551234567,1,NoOp(Meow-Now call from ${CALLERID(num)})
 same => n,Goto(from-trunk,${EXTEN},1)

; Fallback for any unmatched number
exten => _X.,1,NoOp(Fallback: ${EXTEN})
 same => n,Goto(from-trunk,${EXTEN},1)

[internal]
; Internal testing extension (for testing without external calls)
exten => 100,1,NoOp(Internal test call)
 same => n,Answer()
 same => n,AGI(agi://${AGI_HOST}:${AGI_PORT})
 same => n,Hangup()

; Test extension for debugging
exten => 999,1,NoOp(Test Extension)
 same => n,Answer()
 same => n,Playback(hello-world)
 same => n,Hangup()
