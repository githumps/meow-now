# Meow-Now Architecture

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         EXTERNAL WORLD                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â˜ï¸  Caller's Phone                                             â”‚
â”‚       â”‚                                                         â”‚
â”‚       â–¼                                                         â”‚
â”‚  ğŸ“± NumberBarn (SIP Provider)                                   â”‚
â”‚       â”‚                                                         â”‚
â”‚       â”‚ SIP Traffic                                            â”‚
â”‚       â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ Port 5060 UDP (SIP)
        â”‚ Port 10000-10099 UDP (RTP)
        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         HOME NETWORK                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸŒ Router (Port Forwarding)                                    â”‚
â”‚       â”‚                                                         â”‚
â”‚       â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              UNRAID SERVER (DOCKER HOST)                  â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—  â”‚  â”‚
â”‚  â”‚  â•‘            Docker Network (meow-network)           â•‘  â”‚  â”‚
â”‚  â”‚  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£  â”‚  â”‚
â”‚  â”‚  â•‘                                                    â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  Asterisk Container (meow-asterisk)      â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚                                          â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â€¢ Receives SIP calls                   â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â€¢ SIP Trunk to NumberBarn              â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â€¢ Dialplan (extensions.conf)           â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â€¢ Routes to AGI server                 â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚                                          â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  Ports: 5060, 5038, 10000-10099         â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘                 â”‚                                 â•‘  â”‚  â”‚
â”‚  â”‚  â•‘                 â”‚ AGI Protocol (port 4573)        â•‘  â”‚  â”‚
â”‚  â”‚  â•‘                 â”‚                                 â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  Meow-Now Container (meow-now)           â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚                                          â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚  AGI Server (agi_server.py)        â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚  â€¢ Listens on port 4573            â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚  â€¢ Handles Asterisk commands       â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚             â”‚                            â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚  IVR Handler (ivr.py)              â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚  â€¢ Main menu                       â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚  â€¢ Call routing logic              â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚  â€¢ DTMF detection                  â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚             â”‚                            â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚             â”œâ”€Option 1â”€â”€â”  â”Œâ”€Option 2â”€â” â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚             â”‚           â”‚  â”‚          â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â–¼â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚  Meow Mockery   â”‚  â”‚  Talkative  â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚  Handler        â”‚  â”‚  Cats       â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚                 â”‚  â”‚  Handler    â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚             â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚  â”‚ Record    â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚  â”‚ Caller    â”‚  â”‚  â”‚  â”‚ Select â”‚ â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚  â”‚ (60s max) â”‚  â”‚  â”‚  â”‚ Cat    â”‚ â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚        â”‚        â”‚  â”‚      â”‚      â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â” â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚  â”‚ Voice     â”‚  â”‚  â”‚  â”‚ LLM    â”‚ â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚  â”‚ Analyzer  â”‚  â”‚  â”‚  â”‚ Gen    â”‚ â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚  â”‚ (pitch/   â”‚  â”‚  â”‚  â”‚ (Ollamaâ”‚ â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚  â”‚  rhythm)   â”‚  â”‚  â”‚  â”‚ API)   â”‚ â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚        â”‚        â”‚  â”‚      â”‚      â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â” â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚  â”‚ Meow      â”‚  â”‚  â”‚  â”‚ TTS    â”‚ â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚  â”‚ Generator â”‚  â”‚  â”‚  â”‚ Engine â”‚ â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚  â”‚ (synth)   â”‚  â”‚  â”‚  â”‚ (Piper)â”‚ â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚        â”‚        â”‚  â”‚      â”‚      â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â” â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚  â”‚ Playback  â”‚  â”‚  â”‚  â”‚Playbackâ”‚ â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚  â”‚ & Hangup  â”‚  â”‚  â”‚  â”‚& Hangupâ”‚ â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚                                        â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚  Flask Web Interface (app.py)      â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚  â€¢ Status dashboard (port 5000)    â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚  â€¢ Health checks                   â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â”‚  â€¢ Configuration API               â”‚ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â”‚                                          â”‚     â•‘  â”‚  â”‚
â”‚  â”‚  â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â•‘  â”‚  â”‚
â”‚  â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  Storage:                                                 â”‚  â”‚
â”‚  â”‚  â€¢ /mnt/user/appdata/meow-now/audio/                     â”‚  â”‚
â”‚  â”‚  â€¢ /mnt/user/appdata/meow-now/logs/                      â”‚  â”‚
â”‚  â”‚  â€¢ /mnt/user/appdata/meow-now/models/                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ Tailscale Network (optional)
        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      OLLAMA SERVER (OPTIONAL)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸ¤– Ollama (port 11434)                                         â”‚
â”‚      â€¢ LLM Models (llama2, llama3, etc.)                       â”‚
â”‚      â€¢ Dynamic cat personality generation                      â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Call Flow Sequence

### Option 1: Meow Mockery

```
â”Œâ”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Phoneâ”‚       â”‚NumberBarnâ”‚      â”‚ AGI â”‚       â”‚  Voice  â”‚       â”‚   Meow   â”‚
â”‚     â”‚       â”‚          â”‚      â”‚     â”‚       â”‚Analyzer â”‚       â”‚Generator â”‚
â””â”€â”€â”¬â”€â”€â”˜       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”¬â”€â”€â”˜       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
   â”‚               â”‚               â”‚                â”‚                 â”‚
   â”‚ Dial Number   â”‚               â”‚                â”‚                 â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚                â”‚                 â”‚
   â”‚               â”‚ SIP INVITE    â”‚                â”‚                 â”‚
   â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                â”‚                 â”‚
   â”‚               â”‚               â”‚ Answer()       â”‚                 â”‚
   â”‚               â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚                 â”‚
   â”‚               â”‚               â”‚               â”‚â”‚                 â”‚
   â”‚               â”‚               â”‚ Play Menu    â—„â”¤â”‚                 â”‚
   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚                 â”‚
   â”‚ "Press 1..."  â”‚               â”‚               â”‚                 â”‚
   â”‚               â”‚               â”‚               â”‚                 â”‚
   â”‚ Press 1 (DTMF)â”‚               â”‚               â”‚                 â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚               â”‚                 â”‚
   â”‚               â”‚               â”‚ GetData()     â”‚                 â”‚
   â”‚               â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚                 â”‚
   â”‚               â”‚               â”‚              â”‚â”‚                 â”‚
   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Instructionsâ—„â”¤â”‚                 â”‚
   â”‚ "Start talking after beep"    â”‚              â”‚                 â”‚
   â”‚               â”‚               â”‚               â”‚                 â”‚
   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Beep         â”‚                 â”‚
   â”‚               â”‚               â”‚               â”‚                 â”‚
   â”‚ Speak (RTP)   â”‚               â”‚               â”‚                 â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Record()      â”‚                 â”‚
   â”‚ [60s max]     â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚                 â”‚
   â”‚               â”‚               â”‚              â”‚â”‚                 â”‚
   â”‚ Press # or    â”‚               â”‚    Save WAV â—„â”¤â”‚                 â”‚
   â”‚ 60s elapsed   â”‚               â”‚              â”‚                 â”‚
   â”‚               â”‚               â”‚ Recording.wav â”‚                 â”‚
   â”‚               â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                 â”‚
   â”‚               â”‚               â”‚               â”‚ Analyze Pitch   â”‚
   â”‚               â”‚               â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
   â”‚               â”‚               â”‚               â”‚                â”‚â”‚
   â”‚               â”‚               â”‚               â”‚ Extract Rhythm â”‚â”‚
   â”‚               â”‚               â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚â”‚
   â”‚               â”‚               â”‚               â”‚                â”‚â”‚
   â”‚               â”‚               â”‚               â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
   â”‚               â”‚               â”‚               â”‚ Analysis Data   â”‚
   â”‚               â”‚               â”‚               â”‚                 â”‚
   â”‚               â”‚               â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚               â”‚               â”‚               â”‚  Match Pitch    â”‚
   â”‚               â”‚               â”‚               â”‚  Match Rhythm   â”‚
   â”‚               â”‚               â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
   â”‚               â”‚               â”‚               â”‚                â”‚â”‚
   â”‚               â”‚               â”‚               â”‚ Generate Meows â”‚â”‚
   â”‚               â”‚               â”‚               â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
   â”‚               â”‚               â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                 â”‚
   â”‚               â”‚               â”‚ Meow.wav      â”‚                 â”‚
   â”‚               â”‚               â”‚               â”‚                 â”‚
   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Play Meows   â”‚                 â”‚
   â”‚ Meow meow!    â”‚               â”‚               â”‚                 â”‚
   â”‚               â”‚               â”‚               â”‚                 â”‚
   â”‚               â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Hangup()      â”‚                 â”‚
   â”‚ Call Ended    â”‚               â”‚               â”‚                 â”‚
   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚               â”‚                 â”‚
   â”‚               â”‚               â”‚               â”‚                 â”‚
```

### Option 2: Talkative Cats

```
â”Œâ”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”
â”‚Phoneâ”‚     â”‚NumberBarnâ”‚    â”‚ AGI â”‚     â”‚ Cat  â”‚    â”‚Ollamaâ”‚    â”‚ TTS â”‚
â”‚     â”‚     â”‚          â”‚    â”‚     â”‚     â”‚Selectâ”‚    â”‚      â”‚    â”‚     â”‚
â””â”€â”€â”¬â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”¬â”€â”€â”˜     â””â”€â”€â”€â”¬â”€â”€â”˜    â””â”€â”€â”€â”¬â”€â”€â”˜    â””â”€â”€â”¬â”€â”€â”˜
   â”‚             â”‚              â”‚            â”‚           â”‚          â”‚
   â”‚ Dial        â”‚              â”‚            â”‚           â”‚          â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚              â”‚            â”‚           â”‚          â”‚
   â”‚             â”‚ SIP INVITE   â”‚            â”‚           â”‚          â”‚
   â”‚             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚            â”‚           â”‚          â”‚
   â”‚             â”‚              â”‚ Answer()   â”‚           â”‚          â”‚
   â”‚             â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚           â”‚          â”‚
   â”‚             â”‚              â”‚           â”‚â”‚           â”‚          â”‚
   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Play Menuâ—„â”¤           â”‚          â”‚
   â”‚ "Press 2..."â”‚              â”‚           â”‚           â”‚          â”‚
   â”‚             â”‚              â”‚           â”‚           â”‚          â”‚
   â”‚ Press 2     â”‚              â”‚           â”‚           â”‚          â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚           â”‚           â”‚          â”‚
   â”‚             â”‚              â”‚ GetData() â”‚           â”‚          â”‚
   â”‚             â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚           â”‚          â”‚
   â”‚             â”‚              â”‚           â”‚ Random()  â”‚          â”‚
   â”‚             â”‚              â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚          â”‚
   â”‚             â”‚              â”‚           â”‚          â”‚â”‚          â”‚
   â”‚             â”‚              â”‚           â”‚ Pick Cat â”‚â”‚          â”‚
   â”‚             â”‚              â”‚           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚          â”‚
   â”‚             â”‚              â”‚           â”‚ (Grumpy) â”‚          â”‚
   â”‚             â”‚              â”‚           â”‚          â”‚          â”‚
   â”‚             â”‚              â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚          â”‚
   â”‚             â”‚              â”‚           â”‚ Generate â”‚          â”‚
   â”‚             â”‚              â”‚           â”‚          â”‚ LLM API  â”‚
   â”‚             â”‚              â”‚           â”‚          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
   â”‚             â”‚              â”‚           â”‚          â”‚         â”‚â”‚
   â”‚             â”‚              â”‚           â”‚          â”‚ "Dinner â”‚â”‚
   â”‚             â”‚              â”‚           â”‚          â”‚ is late!"â”‚
   â”‚             â”‚              â”‚           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
   â”‚             â”‚              â”‚           â”‚ Text               â”‚
   â”‚             â”‚              â”‚           â”‚                    â”‚
   â”‚             â”‚              â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
   â”‚             â”‚              â”‚           â”‚ Text-to-Speech     â”‚
   â”‚             â”‚              â”‚           â”‚                    â”‚
   â”‚             â”‚              â”‚           â”‚                   â”Œâ”´â”
   â”‚             â”‚              â”‚           â”‚                   â”‚ â”‚
   â”‚             â”‚              â”‚           â”‚                   â”‚ â”‚Convert
   â”‚             â”‚              â”‚           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
   â”‚             â”‚              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Cat.wav           â””â”€â”˜
   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Play      â”‚                    â”‚
   â”‚ "Dinner is THREE MINUTES   â”‚           â”‚                    â”‚
   â”‚  LATE! ..."â”‚              â”‚           â”‚                    â”‚
   â”‚ [15 seconds]              â”‚           â”‚                    â”‚
   â”‚             â”‚              â”‚           â”‚                    â”‚
   â”‚             â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Hangup()  â”‚                    â”‚
   â”‚ Call Ended  â”‚              â”‚           â”‚                    â”‚
   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚           â”‚                    â”‚
   â”‚             â”‚              â”‚           â”‚                    â”‚
```

## Component Details

### AGI Server (`agi_server.py`)
- **Purpose**: Bridge between Asterisk and Python application
- **Protocol**: AGI (Asterisk Gateway Interface)
- **Port**: 4573 (TCP)
- **Key Functions**:
  - `ANSWER` - Answer incoming call
  - `STREAM FILE` - Play audio
  - `GET DATA` - Get DTMF input
  - `RECORD FILE` - Record caller audio
  - `HANGUP` - End call

### IVR Handler (`services/ivr.py`)
- **Purpose**: Call flow logic and menu routing
- **Functions**:
  - Present main menu
  - Detect DTMF tones (key presses)
  - Route to appropriate handler
  - Play audio prompts

### Voice Analyzer (`services/voice_analyzer.py`)
- **Purpose**: Analyze caller's voice characteristics
- **Methods**:
  - Praat (parselmouth) - Most accurate
  - Aubio - Alternative
  - Basic autocorrelation - Fallback
- **Extracts**:
  - Mean pitch (Hz)
  - Pitch range (min/max)
  - Pitch variance
  - Speech segments
  - Rhythm pattern
  - Speaking rate

### Meow Generator (`services/meow_generator.py`)
- **Purpose**: Synthesize cat meows matching voice
- **Algorithm**:
  1. Scale human pitch to cat range (200-600 Hz)
  2. Generate base sine wave at target frequency
  3. Add harmonics (2nd, 3rd, 4th, 5th)
  4. Apply pitch contour (rise, peak, fall)
  5. Add noise for breathiness
  6. Apply amplitude envelope
  7. Sequence meows matching rhythm

### Cat Personalities (`services/cat_personalities.py`)
- **Grumpy**: Low pitch (0.85x), slow rate (0.9x)
- **Wise**: Normal-low pitch (0.95x), slow rate (0.85x)
- **Anxious**: High pitch (1.15x), fast rate (1.2x)
- **Diva**: High pitch (1.1x), normal rate (1.0x)

## Technology Stack

### Core
- **Python 3.11** - Application runtime
- **Flask** - Web framework
- **Asterisk** - PBX/IVR system

### Audio Processing
- **librosa** - Audio analysis
- **soundfile** - Audio I/O
- **numpy/scipy** - Numerical processing
- **parselmouth-praat** - Pitch detection
- **aubio** - Alternative pitch detection

### TTS Engines
- **Piper TTS** - Fast, local (ONNX models)
- **Coqui TTS** - Higher quality, more customizable

### Optional
- **Ollama** - Local LLM runtime
- **Llama2/Llama3** - Language models

## Deployment Architecture

### Docker Compose (Recommended)
```yaml
services:
  meow-now:      # Python application
  asterisk:      # PBX system
networks:
  meow-network:  # Internal bridge network
```

### Volumes
- `./audio` - Audio files (persistent)
- `./logs` - Application logs
- `./models` - TTS models
- `./.env` - Configuration

### Networking
- **Internal**: Docker network (meow-network)
- **External**: Ports 5060, 10000-10099 forwarded
- **Optional**: Tailscale for Ollama access

## Data Flow

### Audio Pipeline
```
Caller Voice (8kHz ulaw/alaw)
    â†“
Asterisk (RTP receive)
    â†“
AGI Recording (WAV, 8kHz mono)
    â†“
Voice Analyzer (pitch/rhythm extraction)
    â†“
Meow Synthesizer (numpy array generation)
    â†“
Audio File (WAV, 8kHz mono)
    â†“
Asterisk Playback (RTP transmit)
    â†“
Caller Hears Meows
```

### Cat Personality Pipeline
```
Random Selection
    â†“
Ollama LLM Query (optional)
    â†“
Text Generation
    â†“
TTS Engine (Piper/Coqui)
    â†“
Audio Generation (WAV)
    â†“
Pitch/Speed Adjustment
    â†“
Playback to Caller
```

## Performance Considerations

### CPU Usage
- **Voice Analysis**: 5-10% per call
- **Meow Synthesis**: 3-5% per call
- **TTS Generation**: 5-15% per call (Piper < Coqui)
- **Ollama LLM**: Varies by model and hardware

### Memory Usage
- **Base Application**: ~200 MB
- **Per Call**: ~50 MB
- **TTS Models**: 50-500 MB (loaded once)
- **Temporary Audio**: ~5 MB per call

### Latency
- **Call Answer**: <1 second
- **DTMF Detection**: <100ms
- **Recording**: Real-time (no latency)
- **Voice Analysis**: 1-3 seconds
- **Meow Generation**: <1 second
- **TTS Generation**: 1-5 seconds
- **Ollama LLM**: 2-10 seconds

### Concurrent Calls
- **Typical Server**: 5-10 simultaneous calls
- **Beefy Server**: 20+ calls
- **Bottleneck**: Usually CPU for audio processing

## Security Model

### Network Security
- Asterisk exposed on 5060, 10000-10099 (required)
- Flask web interface NOT exposed to internet
- SIP authentication required
- Fail2ban recommended for brute force protection

### Application Security
- No user-uploaded executables
- Audio files sanitized (format validation)
- DTMF input validated
- No SQL database (no injection risk)
- Secrets in environment variables

### Access Control
- AMI (Asterisk Manager) password protected
- Flask SECRET_KEY for session security
- Optional: VPN for administration

## Scalability

### Vertical Scaling
- More CPU cores â†’ more concurrent calls
- More RAM â†’ more TTS model variants
- SSD â†’ faster audio I/O

### Horizontal Scaling
- Multiple Meow-Now containers (load balanced)
- Shared audio storage (NFS/Ceph)
- Centralized Ollama server
- Database for call tracking (future)

### Limitations
- Single Asterisk instance (SIP trunk limitation)
- Stateful calls (can't migrate mid-call)
- Audio processing CPU-bound
